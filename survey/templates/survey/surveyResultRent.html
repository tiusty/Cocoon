{% extends "bootstrapJQuery.html" %}
{% load static %}
{% block title %}Survey Result{% endblock %}

{% comment %}
Global variables are listed below
{% endcomment %}

{% block head %}
  {{ block.super }}
  <!-- JQuery UI style sheet, mostly used for slider ui -->
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

  <!-- Style sheets for template page -->
  <link href="{% static 'Unicorn/homes/css/tiles.css' %}" rel="stylesheet">
  <link href="{% static 'survey/dashboard.css' %}" rel="stylesheet">
  <link href="{% static 'survey/GoogleMapStyle.css' %}" rel="stylesheet">
  <link href="{% static 'Unicorn/homes/css/homeModal.css' %}" rel="stylesheet">
  <link href="{% static 'survey/sidebarnav.css' %}" rel="stylesheet">
{% endblock %}

{% block nav-survey %}
  <li class="active"><a>Survey</a></li>{% endblock %}

{% block container_type %}container-fluid{% endblock %}
{% block content %}

  {% comment %}
    <h3>Note all the homes currently have a move in day of Feburary if you are wondering why nothing shows up</h3>
    {% endcomment %}
  {% comment %}
        Modal assumes it is being called within a for loop
    {% endcomment %}
  {% for houseStruct in houseList %}
    <!-- Modal -->
    {% with house=houseStruct.house %}
      {% include "homes/homeModal.html" with modalId="myModal" %}
    {% endwith %}
  {% endfor %}
  <div class="row" id="row-main">
    <div id="sidebarSurvey" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <form action="{% url 'survey:rentSurveyResult' survey_id=survey.id %}" method="post">
        {{ form.non_field_errors }}
        {{ form.errors }}
        {% csrf_token %}
        <div class="form-group step_div">
          <div class="form-group">
            {{ form.name.label_tag }}
            {{ form.name }}
            {{ form.name.errors }}
          </div>
          <div class="form-group">
            {{ form.move_in_date_start.label_tag }}
            {{ form.move_in_date_start }}
            {{ form.move_in_date_start.errors }}
          </div>
          <div class="form-group">
            {{ form.move_in_date_end.label_tag }}
            {{ form.move_in_date_end }}
            {{ form.move_in_date_end.errors }}
          </div>
          <div class="form-group">
            {{ form.num_bedrooms.label_tag }}
            {{ form.num_bedrooms }}
            {{ form.num_bedrooms.errors }}
          </div>
          <div class="form-group">
            {{ form.home_type.label_tag }}
            {{ form.home_type }}
            {{ form.home_type.errors }}
          </div>
          <div class="form-group">
            <label for="amountCost">Cost Per Month:</label>
            <input type="text" id="amountCost" name="amountCost" readonly
                   style="border:0; color:#f6931f; font-weight:bold;">
            <div id="cost"></div>
            {{ form.min_price }}
            {{ form.max_price }}
          </div>
          <div class="form-group">
            {{ form.price_weight.label_tag }}
            {{ form.price_weight }}
            {{ form.price_weight.errors }}
          </div>
          <br>
          <div class="form-group step_div">
            <div class="form-group">
              <label for="amountCommute">Commute:</label>
              <input type="text" id="amountCommute" name="amountCommute" readonly
                     style="border:0; color:#f6931f; font-weight:bold;">
              <div id="commute"></div>
              {{ form.min_commute }}
              {{ form.max_commute }}
            </div>
            <div class="form-group">
              {{ form.commute_weight.label_tag }}
              {{ form.commute_weight }}
              {{ form.commute_weight.errors }}
            </div>
            <div class="form-group">
              {{ form.commute_type.label_tag }}
              {{ form.commute_type }}
              {{ form.commute_type.errors }}
            </div>
          </div>
          <br>
        </div>
        <div class="form-group">
          <div class="panel-group" id="accordion">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
                    Interior Amenities</a>
                </h4>
              </div>
              <div id="collapse1" class="panel-collapse collapse in">
                <div class="panel-body">
                  <p>
                    {{ form.air_conditioning.label_tag }}
                    {{ form.air_conditioning }}
                    {{ form.air_conditioning.errors }}
                  </p>

                  <p>
                    {{ form.wash_dryer_in_home.label_tag }}
                    {{ form.wash_dryer_in_home }}
                    {{ form.wash_dryer_in_home.errors }}
                  </p>

                  <p>
                    {{ form.dish_washer.label_tag }}
                    {{ form.dish_washer }}
                    {{ form.dish_washer.errors }}
                  </p>

                  <p>
                    {{ form.bath.label_tag }}
                    {{ form.bath }}
                    {{ form.bath.errors }}
                  </p>

                  <p>
                    <label for="amountBathrooms"># Bathrooms:</label>
                    <input type="text" id="amountBathrooms" name="amountBathrooms" readonly
                           style="border:0; color:#f6931f; font-weight:bold;">
                  <div id="bathrooms"></div>
                  {{ form.min_bathrooms }}
                  {{ form.max_bathrooms }}
                  {{ form.min_bathrooms.errors }}
                  {{ form.max_bathrooms.errors }}
                  </p>
                </div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
                    Building/Exterior Amentities</a>
                </h4>
              </div>
              <div id="collapse2" class="panel-collapse collapse">
                <div class="panel-body">
                  <p>
                    {{ form.parking_spot.label_tag }}
                    {{ form.parking_spot }}
                    {{ form.parking_spot.errors }}
                  </p>
                  <p>
                    {{ form.washer_dryer_in_building.label_tag }}
                    {{ form.washer_dryer_in_building }}
                    {{ form.washer_dryer_in_building.errors }}
                  </p>
                  <p>
                    {{ form.elevator.label_tag }}
                    {{ form.elevator }}
                    {{ form.elevator.errors }}
                  </p>
                  <p>
                    {{ form.handicap_access.label_tag }}
                    {{ form.handicap_access }}
                    {{ form.handicap_access.errors }}
                  </p>
                  <p>
                    {{ form.pool_hot_tub.label_tag }}
                    {{ form.pool_hot_tub }}
                    {{ form.pool_hot_tub.errors }}
                  </p>
                  <p>
                    {{ form.fitness_center.label_tag }}
                    {{ form.fitness_center }}
                    {{ form.fitness_center.errors }}
                  </p>
                  <p>
                    {{ form.storage_unit.label_tag }}
                    {{ form.storage_unit }}
                    {{ form.storage_unit.errors }}
                  </p>
                </div>
              </div>
            </div>
            {% comment %}
                                Not currently needed so commenting out
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h4 class="panel-title">
                                            <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">
                                                Something else 2</a>
                                        </h4>
                                    </div>
                                    <div id="collapse3" class="panel-collapse collapse">
                                        <div class="panel-body">
                                        </div>
                                    </div>
                                </div>

                            {% endcomment %}
          </div>
        </div>
        <div class="form-group">
          <button type="submit" id="Submit" class="btn btn-primary">Submit Survey</button>
        </div>
      </form>
    </div>
    <div class="nopadding-row row main" id="contentSurvey">
      {% if error_message %}
        <div class="col-sm-12" style="text-align:center">
          <div style="color:red">
            <p><strong>
              {% for error in error_message %}
                {{ error }}
              {% endfor %}
            </strong></p>
          </div>
        </div>
      {% endif %}

      <div class="nopadding-row row">
        <div class="nopadding col-sm-6">
          <h1 class="page-header">
            <span style="margin-left:10px;font-size:30px;cursor:pointer" onclick="openNav()">&#9776; Edit Survey</span>
          </h1>
          <div class="map_wrapper">
            <div id="map"></div>
          </div>

        </div>

        {# Beginning of the new tile survey result list #}
        <div class="resultTiles col-sm-6">
          <h1 class="page-header">Home List</h1>

          <div class="tileTable">


            <script>

                // initializing the pin object
                function locationPin(lat, lon, id, score, fillColor) {
                    this.latitude = lat;
                    this.longitude = lon;
                    this.pinID = id;
                    this.label = score;
                    this.color = fillColor;
                }

                function colorFromScore(score) {
                    if (score > 86) {
                        return 'green';
                    } else if (score > 79) {
                        return '#CDDC39';
                    } else if (score > 69) {
                        return '#FFC107';
                    } else if (score > 59) {
                        return '#FF6D00';
                    } else {
                        return '#DD2C00';
                    }
                }

                var myLocations = [];

            </script>

            {% for home in houseList %}



              {% include "homes/tiles.html" with includeScore=True theHouse=home.house homeScore=home.get_final_score %}

              <script>

                  var lat = {{ home.house.get_lat|safe }};
                  var lon = {{ home.house.get_lon|safe }};
                  var id = {{ forloop.counter }};
                  var score = {{ home.get_final_score }};
                  var color = colorFromScore({{ home.get_final_score }});

                  console.log(colorFromScore({{ home.get_final_score }}));

                  // associate a pin with each result

                  myLocations.push(new locationPin(lat, lon, id, score.toString(), color.toString()));

              </script>


            {% endfor %}

          </div>
        </div>

      </div>
    </div>
  </div>
{% endblock %}

{% block endScripts %}
  {{ block.super }}

  {% comment %}Variables for google map generating with markers and for sliders {% endcomment %}
  <script>
      {% comment endScritps %}
      // Deprecating computing commute time and distance in favor of doing in on the server side
      // Going to keep the portions that create the markers on the map
      {% endcomment %}
      var myStreetAddresses = [{% for location in locations %}"{{ location.get_full_address }}",{% endfor %}];
      var myDestinations = [{% for dest in houseList %}[{{ dest.house.get_lat|safe }}, {{ dest.house.get_lon|safe }}
          ],{% endfor %}];
      // Manipulated by survey_result.js in selectAddress
      //var myDestination = "{{ houseList.0.address }}";
      // Manipulated by costSliderResults.js
      costSliderMax = {{ form.max_price.value }};
      costSliderMin = {{ form.min_price.value }};
      commuteSliderMin = {{ form.min_commute.value }};
      commuteSliderMax = {{ form.max_commute.value }};
      bathroomsMin = {{ form.min_bathrooms.value }};
      bathroomsMax = {{ form.max_bathrooms.value }};
  </script>

  {#    <script src="{% static 'homePage/carousel.js' %}"></script>#}
  <script src="{% static 'survey/tileCarousel.js' %}"></script>
  <!-- Custom Javascript -->
  {% comment %}This script enables ajax request by sending the appropriate authentication elements{% endcomment %}
  <script src="{% static 'Unicorn/global_functions/javascript/getCookie.js' %}"></script>
  {% comment %}This script adds the set_visit_house function which enables adding homes to the users visit list{% endcomment %}
  <script src="{% static 'Unicorn/homes/javascript/set_visit_house.js' %}"></script>
  {% comment %}This script adds the set_favorite function which allows the user to toggle a home in their favorites list{% endcomment %}
  <script src="{% static 'Unicorn/homes/javascript/set_favorite.js' %}"></script>
  <script src="{% static 'survey/costSlider.js' %}"></script>
  <script src="{% static 'survey/commuteSlider.js' %}"></script>
  <script src="{% static 'survey/bathroomsSlider.js' %}"></script>

  <!-- Loading scripts at the end to increase loading times -->
  <script src="{% static 'survey/moveInDatePicker.js' %}"></script>
  <script src="{% static 'survey/tileInteraction.js' %}"></script>
  <script src="{% static 'survey/survey_result.js' %}"></script>
  <script src="{% static 'survey/addMarkers.js' %}"></script>
  <script src="{% static 'survey/addGoogleMap.js' %}"></script>
  <script src="{% static 'survey/expandTile.js' %}"></script>

  <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDocEM2aNmd47atCkIpw2zXOBShUhF3PwE &callback=initMap"></script>

{#   <script#}
{#      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC4N8QDafqOvYtrCux4fLHIwGEDqFCwo_w &callback=initMap"></script>#}



  <!-- JQuery UI for sliders -->
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <script src="{% static 'survey/markerclusterer.js' %}"></script>

  <script>

    /* Set the width of the side navigation to 250px */
    function openNav() {
        document.getElementById("sidebarSurvey").classList.add("openNav");
        $('.sidenav').css("height", $(document).height() - $('.navbar').height() - $('.footer').height());

        if ($(window).width() < 768) {
            document.getElementById("sidebarSurvey").style.width = "100%";
        } else if ($(window).width() < 900) {
            document.getElementById("sidebarSurvey").style.width = "60%";
        } else {
            document.getElementById("sidebarSurvey").style.width = "40%";
        }
    }

    $(window).resize(function () {
        if ($(this).width() <= 768) {

            if ($('.openNav').length) {
                document.getElementById("sidebarSurvey").style.width = "100%";

            }


        } else if ($(window).width() < 900) {

            if ($('.openNav').length) {
                document.getElementById("sidebarSurvey").style.width = "60%";

            }

        } else {

            if ($('.openNav').length) {
                document.getElementById("sidebarSurvey").style.width = "40%";

            }

        }
    })


    /* Set the width of the side navigation to 0 */
    function closeNav() {
        document.getElementById("sidebarSurvey").style.width = "0";
        document.getElementById("sidebarSurvey").classList.remove("openNav")
    }

    var markerCluster = new MarkerClusterer(map, markers, {
        imagePath: "{% static 'survey/images/m' %}"
    });

  </script>



{% endblock %}
