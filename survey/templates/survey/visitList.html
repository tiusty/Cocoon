{% extends "bootstrapJQuery.html" %}
{% load static %}
{% block title %}My Visit List{% endblock %}

{% block head %}
    {{ block.super }}

    <!-- Style sheets for template page -->
    <link href="{% static 'Unicorn/homes/css/homeModal.css' %}" rel="stylesheet">

{% endblock %}

{% block content %}

    {% comment %}
        Modal assumes it is being called within a for loop
    {% endcomment %}
    {% for house in visit_list_set %}
        <!-- Modal -->
        {% include "homes/homeModal.html" with modalId="myModalVisit" %}
    {% endfor %}

    <div class="jumbotron">
        <h1>Your Visit List!</h1>
        <p>Here is your list of homes that you are currently visiting</p>
    </div>

    <table class="table table-striped table-hover table-responsive">
        <tbody>
        <thead>
        <tr>
            <th>Toggle</th>
            <th>Home</th>
        </tr>
        </thead>
        {% for home in visit_list_set %}
            <tr>
                <td style="vertical-align:middle">
                    <h3 style="margin-top: 10px;">
                                    <span data-toggle="modal" class="accordion-toggle glyphicon glyphicon-plus"
                                          data-target="#myModalVisit{{ forloop.counter }}"
                                          style="padding-right:1em"></span>
                    </h3>
                </td>
                <td style="vertical-align:middle">
                    {{ home.get_address }}
                </td>
            </tr>
        {% empty %}
            <tr>
                <td>You do not have any homes to visit</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block endScripts %}
    {{ block.super }}

    <script>
        // using jQuery
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                    // Only send the token to relative URLs i.e. locally.
                    xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
                }
            }
        });
    </script>

    <!-- Custom Javascript -->
    <script src="{% static 'Unicorn/homes/javascript/set_visit_house.js' %}"></script>

{% endblock %}